#!/usr/bin/env bash
#
# Lint command for claude-mm-tool
#
# Usage:
#   ./run lint        - Check code quality
#   ./run lint fix    - Auto-fix issues

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
ROOT="$(cd "$SCRIPT_DIR/../.." && pwd)"

main() {
    local fix_mode="${1:-check}"

    cd "$ROOT"

    # Use venv if available
    local python="python3"
    if [[ -d "$HOME/.local/venvs/ai" ]]; then
        python="$HOME/.local/venvs/ai/bin/python3"
    fi

    echo "ðŸ” Linting Python files..."

    if [[ "$fix_mode" == "fix" ]]; then
        echo "==> Running ruff check --fix"
        "$python" -m ruff check --fix bin/ai src/claude_mm tests 2>&1 || {
            echo "ðŸ’¡ Some issues couldn't be auto-fixed"
            return 1
        }
        echo "âœ“ Python linting complete (auto-fixed)"
    else
        echo "==> Running ruff check"
        "$python" -m ruff check bin/ai src/claude_mm tests 2>&1 || {
            echo "ðŸ’¡ Run './run lint fix' to auto-fixed issues"
            return 1
        }
        echo "âœ“ Python linting OK"
    fi
}

main "$@"
